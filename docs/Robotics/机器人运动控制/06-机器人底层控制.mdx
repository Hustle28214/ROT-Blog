## 6.1 电机的选择与惯量计算

机器人的底层控制主要是控制机器人的执行部件，电机是驱动机器人运动的常用部件，此外还有液压、气动等驱动方式。一个机器人最主要的控制量就是控制机器人移动，无论是自身的移动还是手臂等关节的移动，所以机器人底层控制最根本的问题就是控制电机。**控制电机转的圈数**，就可以控制机器人移动的距离和方向，机械手臂的弯曲程度或者移动的距离等。

### 6.1.1 电机的选择

电机的动力荷载容易受到影响。伺服驱动装置是机器人必不可少的关键环节，因此，伺服电机的选择就变得尤为重要。选择什么样的伺服电机，在很大程度上取决于负载的物理特性，负载的工作特性、系统要求以及工作环境。一旦系统要求确定后，无论选择何种形式的伺服电机，首先要考虑的是选择多大的电机合适，主要考虑负载的物理特性，包括**负载、转速、惯量**等。


伺服电机（servo motor）是指在伺服系统中控制机械元件运转的发动机，分为**直流**和**交流**伺服电动机两大类，其主要特点是，当信号电压为零时无自转现象，转速随着转矩的增加而匀速下降。

伺服电机每旋转一个角度，都会发出对应数量的脉冲，这样，和伺服电机接受的脉冲形成了呼应，或者叫闭环，如此一来，系统就会知道发了多少脉冲给伺服电机，同时又收了多少脉冲回来，从而精确定位。

#### 伺服电机分类

直流伺服电机分为有刷和无刷电机。有刷电机成本低，结构简单，启动转矩大，调速范围宽，控制容易，需要维护，但维护不方便（换碳刷），产生电磁干扰，对环境有要求。因此它可以用于对成本敏感的普通工业和民用场合。

交流伺服电机也是无刷电机，分为同步和异步电机，目前运动控制中一般都用同步电机，它的功率范围大，可以做到很大的功率。大惯量，最高转动速度低，且随着功率增大而快速降低。因而适合做低速平稳运行的应用。            

交流伺服电机的主要优点有：

⑴**无电刷**和**换向器**，因此工作可靠，对维护和保养要求低。

⑵定子绕组散热比较方便。

⑶**惯量小**，易于提高系统的快速性。

⑷适应于高速大力矩工作状态。

⑸同功率下有较小的体积和重量。

直流无刷伺服电机特点:

无刷伺服电机在执行伺服控制时，无须编码器也可实现速度、位置、扭矩等的控制； 不存在电刷磨损情况，除转速高之外，还具有**寿命长、噪音低、无电磁干扰**等特点。

直流**有刷**伺服电机特点

1. 体积小、动作快反应快、过载能力大、调速范围宽

2. 低速力矩大, 波动小，**运行平稳**

3. 低噪音,高效率

4. 后端编码器反馈（选配）构成直流伺服等优点

5. 变压范围大，频率可调


伺服电机和其他电机（如步进电机）相比的优点:

1、精度：实现了位置，速度和力矩的闭环控制；克服了步进电机失步的问题；

2、转速：高速性能好，一般额定转速能达到2000～3000转；

3、适应性：抗过载能力强，能承受三倍于额定转矩的负载，对有瞬间负载波动和要求快速起动的场合特别适用；

4、稳定：低速运行平稳，低速运行时不会产生类似于步进电机的步进运行现象。适用于有高速响应要求的场合；

5、及时性：电机加减速的动态相应时间短，一般在几十毫秒之内；

6、舒适性：发热和噪音明显降低。

伺服电机选型的原则：

1. 负载/电机惯量比

正确设定惯量比参数是充分发挥机械及伺服系统最佳效能的前提，此点在要求高速精度的系统上表现尤为突出，在没有自适应调整的情况下，伺服系统的默认参数在1到3倍负载电机惯量比下，系统会达到最佳工作状态。

2. 转速

电机选择首先应依据机械系统的快速行程速度来计算，快速行程的电机转速应严格控制在电机的额定转速之内，并应在接近电机的额定转速的范围使用。

3. 转矩

伺服电机的额定转矩必须满足实际需要，但是不需要留有过多的余量，因为一般情况下，其最大转矩为额定转矩的3倍。

4. 连续特性（连续实效负载转矩）

对要求频繁起动、制动的工作场合，为避免电机过热，必须检查它在一个周期内电机转矩的均方根值，并使它小于电机连续额定转矩。

5. 短时间特性（加减速转矩）

伺服电机除连续运转区域外，还有短时间内的运转特性如电机加减速，用最大转矩表示，即使容量相同，最大转矩也会因各电机而有所不同。
      
6. 注意事项

（1）有些系统如传送装置，升降装置等要求伺服电机能尽快停止，而在故障、急停、电源断电时伺服器没有再生制动，无法对电机减速。同时系统的机械惯量又较大，这时对制动器要依据负载的轻重、电机的工作速度等选择。

（2）有些系统要维持机械装置的静止位置，需电机提供较大的输出转矩，且停止的时间过长。如果使用伺服的自锁功能，往往会造成电机过热，这种情况要选择带电磁制动的电机。

（3）如果选择了带电磁制动器的伺服电机，电机的转动惯量会增大，计算转矩时要进行考虑。


### 6.1.2 步进电机

#### 一、概念及分类

步进电动机是一种用电脉冲信号进行控制，并将电脉冲信号转换成相应的角位移或线位移的控制电机。

主要优点：**步距角**和**转速**不受电压波动和负载变化的影响，仅与**脉冲频率**有关。它每转一周都有固定的步数，在不丢步的情况下运行，其步距误差不会长期积累，从而使它适合于在数字控制的开环系统中作为驱动电动机，也可用作闭环系统的驱动元件。

主要缺点：效率较低，需配适当的驱动电源，带惯性负载的能力不强。


#### 二、步进电机的特性

1.高精度的定位

步进电机最大特征即是能够简单的做到高精度的定位控制。以5相步进电机为例：其定位基本单位（分辨率）为0.72°（全步级）/0.36°（半步级），是非常小的；停止定位精度误差皆在±3分（±0.05°）以内，且无累计误差，故可达到高精度的定位控制。

2.具定位保持力

步进电机在停止状态下（无脉波信号输入时），仍具有激磁保持力，故即使不依靠机械式的剎车，也能做到停止位置的保持。

3.动作灵敏

步进电机因为加速性能优越,所以可做到瞬时起动、停止、正反转之快速、频繁的定位动作。

4.开回路控制、不必依赖传感器定位

步进电机的控制系统构成简单，不需要速度感应器（ENCODER、转速发电机）及位置传感器（SENSOR），就能以输入的脉波做速度及位置的控制。也因其属开回路控制，故最适合于短距离、高频度、高精度之定位控制的场合下使用。

#### 三、工作原理

三相反应式步进电动机有三种运行方式：

（1）三相单三拍运行；

（2）三相双三拍运行；

（3）三相单、双六拍运行

“三相” —指步进电机的相数；

“单”  —指每次只给一相绕组通电；“双”则是每次同时给二相绕组通电；

“三拍”—指通电三次完成一个循环

步进电机按**A-B-C-A**的顺序通电，电机转子在**磁阻转矩**作用下沿**ABC**方向转动，电机的**转速**直接取决于控制绕组的**换接频率**。三相单三拍的特点：

（1）每来一个电脉冲，转子转过 30。此角称为步距角。

（2）转子的旋转方向取决于三相线圈通电的顺序，改变通电顺序即可改变转向。

对于其它相数的步进电动机，同样可以有多种运行方式，例如四相步进电动机有：**四相单四拍，四相双四拍，四相单双八拍**等运行方式。

一般而言，无论几相电机以及采用何种运行方式，步距角与转子齿数Zr和拍数N之间有如下关系：

$$
\theta_s = \frac{360}{ZrN} 
$$

$$
N = mc
$$
此处，m为控制绕组相数，C为状态系数，单三、双三拍时，C=1；单双六拍时C=2。

### 6.1.3 舵机与转向控制

**舵机**是一种 **位置(角度)** 伺服的驱动器，由于可以通过程序连续控制其转角，因而被广泛应用智能小车以实现转向以及机器人各类关节运动中。

舵机主要有几以下个部分组成：**外壳、减速齿轮组、电机、电位器、控制电路**。简单的工作原理是控制电路接收信号源的控制信号，并驱动电机转动；齿轮组将电 机的速度成大倍数缩小，并将电机的输出扭矩放大响应倍数，然后输出；电位器和齿轮组的末级一起转动，测量舵机轴转动角度；电路板检测并根据电位器判断舵机转动角度，然后控制舵机转动到目标角度或保持在目标角度。

控制电路板接受来自信号线的控制信号，控制电机转动，电机带动一系列齿轮组，减速后传动至输出舵盘。舵机的输出轴和位置反馈电位计是相连的，舵盘转动的同时，带动位置反馈电位计，电位计将输出一个电压信号到控制电路板，进行反馈，然后控制电路板根据所在位置决定电机转动的方向和速度，从而达到目标停止。其工作流程为：**控制信号→控制电路板→电机转动→齿轮组减速→舵盘转动→位置反馈电位计→控制电路板反馈**。


舵机的控制信号周期为20ms的**脉宽调制（PWM）信号**，其中脉冲宽度从0.5-2.5ms,相对应的舵盘位置为**0－180度**，呈线性变化。也就是说，给它提供一定的脉宽，它的输出轴就会输出相应的角度，无论外界转矩怎么改变，直到给它提供一个另外宽度的脉冲信号，它才会改变输出角度到新的对应位置上。舵机内部有一个**基准电路**，产生周期为20ms，宽度1.5ms的基准信号，有一个比较器，将外加信号与基准信号相比较，判断出方向和大小，从而生产电机的转动信号。由此可见，舵机是一种**位置伺服驱动器**，转动范围不能超过180度，适用于那些需要不断变化并可以保持的驱动器中，比如说机器人的关节、飞机的舵面等。舵机输出转角与输入脉冲的关系如图4-4所示。

### 6.1.4 惯量计算

**惯量**是影响伺服电机工作的一个指标，通常小惯量电机的高速往复性好，大惯量电机本身惯量比较大，适用于负载相对比较大的场合，比如机床行业。我们在选择伺服电机的时候常常需要选择合适的扭矩和惯量，扭矩的选择相对简单，只需要知道负载重量和传动方式一般很快就能计算出电机所需的力矩，选型的时候适当放大，留有余量就可以了。而**电机惯量**，也是伺服电机的一项重要指标，它是指伺服电机转子本身的惯量，对于电机的加减速来说相当重要，如果不能很好的匹配惯量，电机的动作会很不平稳。不同的工作方式，其惯量计算的方法也不一样。

以下介绍求旋转圆盘惯量的计算方法。

:::warning
已知：圆盘质量M=50kg，圆盘直径D=500mm，圆盘最高转速60rpm，请选择伺服电机的功率。

:::

<details>
<summary>解析</summary>

计算圆盘转动惯量：
$J_L = MD^2/ 8 = 50 * 2500 / 8 = 15625 kg·cm^2  $                                                          

假设减速机减速比1：R，则折算到伺服电机轴上负载惯量为$15625 / R^2$。

按照负载惯量 < 3倍电机转子惯量JM的原则，

如果选择400W电机，$J_M = 0.277kg.cm2$，则$15625 / R^2 < 3*0.277$，$R^2 > 18803$，$R > 137$

输出转速=3000/137=22 rpm，不能满足要求。

如果选择500W电机，$J_M = 8.17kg.cm^2$，则$15625 / R2 < 3*8.17$，$R^2 > 637$，$R > 25$

输出转速=2000/25=80 rpm，满足要求。这种传动方式阻力很小，忽略扭矩计算。

</details>

## 6.2 典型驱动PWM

### 6.2.1 典型驱动


根据能量转换方式，将驱动器划分为液压驱动、气压驱动、电气驱动。在选择机器人驱动器时，除了要充分考虑机器人的工作要求，如工作速度、最大搬运物重、驱动功率、驱动平稳性、精度要求以外，还应考虑是否能够较大的惯性负载条件下，提供足够的加速度以满足作业要求。现在应用较多的是电气驱动，它又分为普通电机驱动、步进电机驱动和直线电机驱动三类。不管是哪种电气驱动，它们的驱动原理都是类似的，都采用了的**H桥式驱动电路**。

**驱动电路**是主电路与控制电路之间的接口，直流电机驱动电路使用最广泛的就是H型全桥式电路，这种驱动电路可以很方便实现直流电机的四象限运行，分别对应正转、正转制动、反转、反转制动。


### 6.2.2 PWM驱动原理

PWM(Pulse Width Modulation)脉冲宽度调制通过改变电机电枢电压接通与断开的时间的的占空比来控制电机的转速。脉冲宽度调制（PWM）是一种对模拟信号电平进行数字编码的方法。

PWM控制电路的示意图上次讲过了，可控开关S以一定的时间间隔重复地接通和断开，当S接通时，供电电源US通过开关S施加到电动机两端，电源向电机提供能量，电动机储能；当开关S断开时，中断了供电电源向电动机电流继续流通。

改变开关接通时间ton和开关周期T的比例也即改变脉冲的占空比，电动机两端电压的平均值也随之改变，因而可以控制电机转速。

## 6.3 运动控制与PID

### 6.3.1 电机正反转分析

**电机驱动电路**采用的是**基于双极型H桥型脉宽调制方式**的集成电路L298N，L298N内部包含2个H桥的高电压大电流桥式驱动器，接收标准TTL逻辑电平信号，可驱动46V、2A以下的电机，工作温度范围从－25度到130度。其内部的一个H桥原理图如图4-9所示。ENABLE A是控制使能端，控制OUTPUTl和OUTPUT2之间电机的停转， INPUT1、INPUT2脚接入控制电平，控制OUTPUTl和OUTPUT2之间电机的转向。当使能端ENABLE A有效，INPUT1为低电平INPUT2为高电平时，三极管2，3导通，1，4截止，电机反转。当INPUT1和INPUT2电平相同时，电机停转。表4-1是其使能引脚，输入引脚和输出引脚之间的逻辑关系。

### 6.3.2 经典PID控制     

PID 控制是比例积分微分控制（Proportional-Integral-Differential），历史最久、应用最广，适应性最强的控制方式，在工业生产过程中，PID控制算法占85%～90%

PID控制器由比例单位(P)、积分单位(I)和微分单元$(D)$,其输入$e(t)$与输出$u(t)$的关系为$u(t)=f[e(t)]$

#### 比例控制

当控制器的输出变化量$Δu$与输入偏差$e$成比例时，就构成了比例控制规律$(P)$，其数学表达式为：

$$
Δu = K_C e
$$

式中，$Δu$ ——比例调节器的输出变化量，$e$——比例调节器的输入信号，$K_C$ ——比例调节器的比例系数。

#### 积分控制

当控制器的输出变化Δu与输入偏差e的积分成比例时，就是积分控制规律I。其数学表达式为：
$$
Δu = K_I \int^t_0 edt
$$

积分控制作用的特征可以用阶跃输入下的输出来说明。当控制器的输入偏差是幅值为A的阶跃信号时，就可以表示为：

$$
Δu = K_I \int^t_0 edt = K_IAt
$$

#### 微分控制

具有微分控制规律（D）的控制器，其输出△u与偏差e的关系可用下式表示：

$$
Δu = K_D \frac{de}{dt}
$$

式中，$T_D$为微分时间。由上式可以看出，微分控制作用的输出大小与偏差变化的速度成正比。对于一个固定不变的偏差，不管这个偏差有多大，输出总是零，这是微分作用的特点。

2.PID控制的特点

① **原理简单，使用方便**。

② **适应性强**，可以广泛应用于化工、热工、冶金、炼油以及造纸、建材等各种生产部门。

③ **鲁棒性强**，即其控制品质对被控对象特性的变化不大敏感。

④ **对模型依赖少**。

微分时间常数$T_d$对控制性能的影响：随着微分时间常数Td的增加，闭环系统响应的**响应速度加快**，调节时间减小，微分环节的主要作用是**提高系统的响应速度**。图4-13为在不同的积分常数Td下，PID控制对系统阶跃响应的影响。

3.控制规律的选择

1. 对于一阶惯性对象，如果负荷变化不大，工艺要求不高，可采用比例$(P)$控制；如果工艺要求较高，采用比例积分$(PI)$控制； 
2. 对于一阶惯性加纯滞后对象，如果负荷变化不大，控制要求精度较高，可采用比例积分控制；
3. 对于纯滞后时间较大，负荷变化也较大，控制性能要求较高的场合，可采用比例积分微分控制；
4. 对于高阶惯性环节加纯滞后对象，负荷变化较大，控制性能要求较高时，应采用串级控制、前馈-反馈、前馈-串级或纯滞后补偿控制。


## 6.4  智能PID整定

近年来，智能控制无论是理论上还是应用技术上均得到了充足的发展，随之不断涌现将智能控制方法和常规PID控制方法融合在一起的新方法，形成了许多形式的智能PID控制器。它吸收了智能控制与常规PID控制两者的优点。首先，它具备自学习、自适应、自组织的能力，能够自动辨识被控过程参数、自动整定控制参数、能够适应被控参数的变化；其次，它又具备常规PID控制器结构简单、鲁棒性强、可靠性高、为现场工程设计人员所熟悉等特点。本节介绍几种常见的智能PID控制器的参数整定和构成方式，包括继电反馈、模糊PID、神经网络PID、参数自整定和专家PID控制及基于遗传算法的PID控制。
                                                   

:::warning
1，伺服电机的选型原则和注意事项有哪些？
2，步进电动机的特征参数有哪些？简单叙述一下三相单三拍步进电机的工作原理。
3，介绍一下舵机的工作原理，舵机主要应用在哪些场合？
4，电机的驱动方式有哪几种？各有什么特点？
5，PID控制器对控制性能有哪些影响？
6，智能PID整定有哪些方法？各有什么特点？


:::