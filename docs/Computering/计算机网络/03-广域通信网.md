> 本章重点主要放在HDLC上，冲刺期直接跳过即可。

## 3.1 广域网物理特性

广域网是通信公司建立和运营的网络。

### 公共交换电话网PSTN

公共交换电话网是为了话音通信建立的网络，从20世纪60年代开始被用于数据传输。时至今日，由于PSTN覆盖面广、费用低的特性，仍然有些地方用户通过电话线拨号上网。

电话线联网时，需在发送端通过调制解调器把数字信号变换为模拟信号，接收端再通过调制解调器将模拟信号变换为数字信号。


![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/52fd08a77ccb330528b6a4853570cbc8.png#pic_center)
公用电话网由本地网和长途网组成，本地网覆盖市内电话、市郊电话以及周围城镇和农村的电话用户，形成属于同一长途区号的局部公共网络。长途网提供各个本地网之间的电话业务，包括国际和国内的长途电话业务。

**我国的固定电话网**采用4级汇接辐射式结构，最高一级有8个大区中心局，包括北京、上海、广州、南京、沈阳、西安、武汉和成都。这些中心局互相连接，形成网状结构。第二级共22个省中心局，第三级300多个地区中心局，第四级是县中心局。大区中心局之间都有直达线路，以下各级汇接至上一级，并辅助一些直达线路。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/a9450e25bd1b3063966878dc54a9fc09.png#pic_center)

电话网由3部分组成：本地回路、干线和交换机。

### 本地回路

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/11042a5d9807546f0de9261a0fab990a.png#pic_center)
用户计算机叫做数据终端设备（Data Terminal Equipment,DTE），通信网络中用于管理网络的接口的设备叫数据电路设备（Data Circuit Equipment,DCE）。DCE通常指调制解调器、数传机、基带传输器、信号变换器、自动呼叫和应答设备等。

干线和交换机一般采用数字传输和交换技术，而本地回路基本采用模拟线路。


### 机械特性

以RS-232-C接口为例，说明描述设备之间通信有关的技术特性。

机械特性描述DTE和DCE之间物理上的分界线，规定连机器的几何形状、尺寸大小、引线数、引线排列方式和锁定装置等。

RS-232-C没有正式规定连机器的标准，只有在其附录中建议使用25针的D型连接器，也有很多使用其他连接器，特别是在微型机RS-232-C串行接口上，大多使用9针连接器。
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/e1af80c958fbd401c99d8d51fa9f8581.png#pic_center)
### 电气特性

电气特性规定信号的连接方式以及驱动器和接收器的电气参数。

RS-232-C采用的V.28标准电路，速率20kb/s，最长15米。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/a0664da4b2e913bebfe9176072b86609.png#pic_center)

信号源产生3-15V的信号，±3V之间是信号电平过渡区。

3-15V表示1，-3-15V表示0。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/e6a535364a616ef9f23d020cd9f426b1.png#pic_center)
另外两种常用的电气特性标准是V.10和V.11。V.11是一种平衡接口，每个接口电路都用一对平衡电缆构成各自的信号回路。V.10的发送端是非平衡输出，接收端则是平衡输入，用于两种电路的转接。

### X.25公共数据网

X.25建议即访问分组交换网的协议标准。该标准分为三层，即物理层、链路层和分组层。（OSI的低三层）

物理层建议：X.21

链路层标准：LAP-B

分组层协议:X.25 PLP协议。（X.25建议核心）


## 3.2 流量控制与差错控制

流量控制：协调发送站和接收站工作步调，避免发送速度过快，接收站处理不了。（X.25、TCP）

差错控制：检测和纠正传输错误的机制。

检错码：CRC
纠错码：海明码

### 流量控制：停等协议

它的工作原理是：发送站发出一帧，然后等待应答信号到达后再发送下一帧；接收站每收到一帧后送回一个应答信号（ACK），表示愿意接收下一帧，如果接收站不送回应答，则发送站必须等待。这样。在源和目标之间的数据流动是由接收站控制的。

假设在半双工的点对点链路上，S1站向S2站发送数据帧，S1每发出一个帧就等待S2送回应答信号。发送一帧的时间为：

$T_{FA}=2t_p+t_f$

其中，$t_p$为传播延迟，$t_f$为发送一帧的时间（称为一帧时）。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/bc7fb29dd2f5a98b5627175980ac3ba0.png#pic_center)

于是线路的利用率为

$E=t_f/2t_p+t_f$,

定义$a=t_p/t_f$，则

$E=1/(2a+1)$，

这就是停等协议下线路的最高利用率，也可以认为是停等协议的效率。

为了更深入，对$a$进行一些分析：由于$a$是线路传播延迟和一个帧时的比，故在线路长度和帧长固定的情况下$a$是一个常数。又由于线路传播延迟是线路长度和信号传播速度$v$的比值，而一帧时是帧长$L$和数据速率$R$的比，因而有

$a=\frac{d/v}{L/R}=\frac{Rd/v}{L}$

式子$Rd/v$的单位为位，其物理意义是线路上能容纳的最大位数，即线路的位长度，它是由线路的物理特性决定的。

### 流量控制：滑动窗口协议

滑动窗口主要思想是允许连续发送多个帧而无需等待应答。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/79318e179a7f8be71667f0a1a8b3865d.png#pic_center)
如图，假设站A和B痛感全双工链路连接，B维持能容纳8个帧的缓冲区（$W_{收}=8$）。这样A就可以连续发送8个帧而不必等待应答信号。

为使B能够表示哪些帧已经被成功接收，每个帧都给予一个顺序编号，若帧编号字段为$k$位，则帧以$2^k$为模连续编号。B发出一个应答信号$ACKi$，并把窗口滑动到$i-W-I+1$的位置，表明$i$之前的帧已正确接收，期望接收后续的$W$个帧。由于随着数据传送过程的进展窗口向前滑动，因而取名滑动窗口协议。

考虑窗口大小W对协议效率的影响。假设A向B发出0号帧，B收到后返回应答帧$ACK1$，并把窗口滑动到图中虚线位置。这个过程的总时长是$2t_p+t_f$，期间A可以连续发送W个帧，工作时间是$W\times t_f$。协议效率为：

$E=W\times t_f/(2t_p+t_f)=W/(2a+1)$

利用全双工线路通信，应答信号可放到B向A方向发送的数据帧中，即“捎带应答”。此时，应答信号传送时间可计入反向发送数据帧的时间中。

### 差错控制

通常有三种应付传输差错的方法：肯定应答、否定应答重发、超时重发。

其中，超时重发技术的主要思想是利用差错检测技术自动地对丢失帧和错误帧请求重发，因而称为ARQ(Automatic Repeat reQuest)技术，又被称为ARQ自动重传协议。这种协议有3种形式。

#### ARQ：停等ARQ协议

停等ARQ协议是停等流控技术和自动请求重发技术的结合。

发送站发出一帧后必须等待应答信号，收到肯定应答信号ACK后继续发送下一帧；收到否定应答信号NAK后重发该帧；若在一定时间内没有收到应答信号也必须重发。


![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/220701d5a4cdecd3dd19217daf2a9d07.png#pic_center)
#### ARQ：选择重发ARQ协议 vs 后退N帧ARQ协议

选择重发ARQ协议是滑动窗口技术和自动请求重发技术的结合，又称连续ARQ协议。它的主要思想是重传特定的某一帧。



这种协议失败的原因常是由于接收窗口和原来的发送窗口中仍有相同的帧编号，造成了接收器误把重发帧当作新到帧。解决办法是缩小窗口，使得接收窗口向前滑动最大距离后不再与旧的接收窗口重叠。当窗口大小为帧编号数的一半的时候可达成。


$W_发=W_收≤2^{k-1}$（k为帧编号位数）

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/ed7cce0989fe95f4cc51f2fb28eb97fc.png#pic_center)

后退N帧ARQ协议就是从出错处重发已发出过的N个帧。比如，第2帧出错，就必须重发2、3、4、5号帧。

这种协议的问题是“捎带应答”带来的应答信号二义性，需要规定窗口的大小。限制发送窗口大小$W_发=W_收≤2^k-1$。


### 帧中继FR（Frame Rlay）

帧中继网络提供虚电路业务。帧中继在第二层（汇聚层）建立虚电路，提供虚电路服务，本地标识DLCI（Data Link Connection Identifier，数据链路连接标识符）。不同的DLCI代表不同的虚电路。DLCI作用范围仅限于本地的链路段。

虚电路分为永久虚电路和交换虚电路。PVC是在两个端用户之间建立的固定逻辑连接，为用户提供约定的服务。帧中继交换设备根据预先配好的DLCI表交换数据帧。SVC是使用ISDN信令协议Q.931临时建立的逻辑连接，以呼叫形式通过信令来建立和释放。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/f2e86ce775fa0d567abbf81d9f9f3871.png#pic_center)

帧中继的虚电路上可以提供不同的服务质量，服务质量参数有下面这些。

接入速率(AR):指DTE可以获得的最大数据速率,实际上就是用户一网络接口的物理速率。 

约定突发量(Bc);指在Tc(时间间隔)内允许用户发送的数据量。 

超突发量(Be):指在Tc内超过Bc部分的数据量,对这部分数据网络将尽力传送。 

约定数据速率(CIR):指正常状态下的数据速率,取Tc内的平均值。 

扩展数据速率(EIR):指允许用户增加的数据速率。 

约定速率测量时间(Tc):指测量Bc和Be的时间间隔。 

信息字段最大长度:指每个帧中包含的信息字段的最大字节数,默认为1600字节。 

这些参数之间有如下关系: 

 $B_c=T_c*CIR$ 

$B_e=T_c*EIR$

对于超过CIR的Bc部分，若出现网络拥塞会被优先丢弃。对于Be部分，网络尽量传送，不保证成功。对于超过Bc+Be的部分，网络拒绝接收。
#### 帧中继协议LAP-D

帧中继（frame relay）是于1992年兴起的一种新的公用数据网通讯协议，1994年开始获得迅速发展。帧中继是一种有效的数据传输技术，它可以在一对一或者一对多的应用中快速而低廉的传输数字信息。每个帧中继用户将得到一个接到帧中继节点的专线。帧中继网络对于端用户来说，它通过一条经常改变且对用户不可见的信道来处理和其他用户间的数据传输。

LAP-D与LAP-B相比，省去了控制字段。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/36891a24b78358b17964edfa273ee54d.png#pic_center)
帧头和帧尾都是一个字节的帧标志字段（01111110）。默认最大长度1600。



**显式拥塞控制**：

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/68cb326fad8f4f9b11e10b8ae0fe5731.png#pic_center)
BECN和FECN分别为向后拥塞位和向前拥塞位。若网络设备置该位为1，则表示在与帧传送相反/相同的方向上出现了拥塞。该帧到达发送端后，发送方可据此调整发送数据速率。称作显式拥塞控制。

另外，用户终端可以根据ISDN上层建立的序列号检测帧丢失的概率，一旦高于一阈限，用户终端自动降低发送速率，即隐式流控。

**强化链路层管理**：

强化链路层管理（CLLM）是另一种拥塞控制的方法。这种CLLM消息通过第二次管理连接（DLCI 1007）成批传送拥塞信息，收到CLLM消息即可采取相应对策缓解拥塞。

LAP-D帧具有下列作用。

（1）通过帧标志字节对帧进行封装。

（2）利用地址字段实现对物理链路的多路复用。

（3）利用帧校验和检查传输错误，丢弃出错的帧。

（4）检查帧的长度在0位插入之前或删除之后是否为整数个字节，丢弃长度出错的帧。

（5）检查太长（超过约定的长度）和太短（少于1600字节）的帧并丢弃。

（6）对网络拥塞进行控制。


#### 帧中继应用

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/f01ae1b9e4f1ff363d555c5829610bd4.png#pic_center)
帧中继远程联网优点：

（1）基于分组（帧）交换的透明传输，可提供面向连接的服务。

（2）帧长可变，长度可达1600-4096字节，可以承载各种局域网的数据帧。

（3）可达很高的速率，2-45Mbps。

（4）既可以按需提供带宽，也可以应付突发的数据传输。

（5）没有流控和重传机制，开销很少。


总结缺点：

（1）不适合对延迟敏感的应用（语音。视频）。

（2）数据的丢失依赖于运营商对虚电路的配置。

（3）不保障可靠的提交。



### ISDN和ATM

ISDN综合数字业务网，目的是以数字系统代替模拟电话系统，把音频、视频、数据业务放在一个网上统一传输。

ISDN分为窄带ISDN（N-ISDN）和宽带ISDN（B-ISDN）。其中，窄带ISDN提供两种用户接口：基本速率2B+D和基群速率30B+D。

D信道是16kbps或64kbps的信令信道。

对于家庭用户，通信公司在用户住所安装一个第一类网络终接设备NT1。用户可以在连接NT1的总线上最多挂接8台设备共享2B+D的144kbps信道。（基本速率：$BRI=2B+D=144kbps$）

对于大型商业用户，则通过第二类网络终接设备NT2连接ISDN，提供30B+D（基群速率：$PRI=30B+D$）的接口速率，甚至更高。NT2是一台专用小交换机（Private Branch eXchange,PBX）,可对数据和话音混合传输。

用户设备分为2种类型：

1. 1型终端设备（TE1）符合ISDN接口标准，可通过数字管道直接连接ISDN，例如数字电话、数字传真机等。
2. 2型终端设备（TE2）是非标准的用户设备，必须通过终端适配器（TA）才能连接ISDN。例如PC，需插入一个ISDN适配卡。


![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/8099ddc551a9b71ca7d7b91813ed7cd4.png#pic_center)

#### B-ISDN体系结构

N-ISDN的缺点是数据速率太低。I.321建议中提出了B-ISDN体系结构和基于分组交换的ATM技术。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/d51904933a332dc36e7bf0d0bcb6a548.png#pic_center)
B-ISDN共分为4个独立的协议层。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/0bd932ddc2a355b1c7ec0c79d9360758.png#pic_center)

B-ISDN的关键技术是异步传输模式。这种模式采用5类双绞线或光纤传输，数据速率可达155Mbps。



#### 同步传输和异步传输

按时分多路原理传输的技术叫做同步传输模式（Synchronus Transfer Mode,STM）。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/0e964df25bd5adf8aad0650fcac37ab8.png#pic_center)
例如在T1载波中，每一话路可以在T1帧中占用一个时槽，每个时槽包含8位。

异步传输模式（Asynchronous Transfer Mode,ATM）是统计时分复用，信元交换模式。它固定组织53字节的用户数据成信元。无数据时，向信道发送空信元，或发送OAM(Operation And Maintenance)信元。它的异步性来源于其不固定的信元排列。

ATM是以虚链路提供面向连接的服务。典型速率为150M。由于其通信的实时性，偶然的错误信元不必重传。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/12de3c7a01a249a3a0f8e071c7e131db.png#pic_center)





## 3.3 HDLC协议
本节非常重要，是第三章的热门考点。

数据链路控制协议可分为两大类，一种面向字符，一种面向位。前者较老，后者较先进。HDLC（High Level Data Link Control,高级数据链路控制）协议则是面向位的协议，它由SDLC协议扩充开发而成。

HDLC通常使用CRC-16、CRC-32校验，帧边界“01111110”。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/6fa54b87486e5da9172f3da0d30947bc.png#pic_center)
### HDLC帧格式及控制字段


![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/c158625695df39799f365390d7546ea7.png#pic_center)
对于控制字段，HDLC定义了三种帧，根据控制字段的格式区分。

信息帧（I帧）承载着要传送的数据，此外还捎带着流量控制和差错控制的应答信号。N(S)表示发送帧序号，N(R)表示下一帧要接收5号帧，均为3位二进制编码，可取值0-7。

管理帧（S帧）用于提供ARQ控制信息，不使用捎带机制时要用S帧控制传输过程。前两位为10，S帧控制字段的第三、四位为S帧类型编码。有4种不同编码。

无编号帧（U帧）提供建立、释放等链路控制功能。要求提供不可靠的无连接服务时，有时可以承载数据。不包含N(S)和N(R)。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/aad5e1f4b3b5a3fd59d76e2f7290e5d2.png#pic_center)
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/986484f7bd1e75e5afe191f2fac948b3.png#pic_center)

### HDLC的操作

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/51dcfd7d93736032361509d94f2f56c9.png#pic_center)
图中，I后面的两个数字表示信息帧的N(S)和N(R)值。管理帧后的数字表示N(R)值，P和F表示该帧中的P/F位置1，没有P和F表示这一位置为0。

（a）说明了链路建立和释放过程：
1. A站发出SABM命令并启动定时器，在一定的时间内，没有应答则重发同一命令。
2. B站以UA帧响应，并对本站的局部变量和计数器进行初始化。
3. A站收到应答后也对本站的局部变量和计数器初始化，并停止计时。
4. 此时逻辑链路建立。
5. 释放链路则由双方交换一对DISC和响应UA完成。


（b）说明了全双工交换信息帧过程：
1. 每个信息帧用N(S)指明发送顺序号，N(R)指明接收顺序号。
2. 当一个站连续发送帧但未收到回应，N(R)字段将不断重复。


（c）说明接收站忙的情况：
1. A站以RNR4响应B站的I30帧，表示A站以正确接收之前的帧，但不能继续接收帧。
2. B站收到RNR4之后，每隔一定时间以P位置1的RNR命令询问接收站状态。
3. A站如果保持忙则以F位置1的RNR帧响应。
4. A站忙态接触，则以F位置1的RR帧响应，于是数据传送从RR应答中的接收序号恢复发送。

（d）说明使用REJ命令：

1. A站发出来第3、4、5信息帧，其中第4帧出错。
2. 接收站检出后，发出REJ4命令，发送站返回到出错帧重发。（后退N帧ARQ技术）

（e）说明超时重发：
1. A站发出第3帧出错，B站检测到错误后丢弃该帧。
2. B站无法发出REJ命令，B站无法判断这是一个I帧。
3. A站超时后，发出P位置1的RNR命令询问B站的状态。
4. B站以RR3F响应，于是数据传送从断点处恢复。

### X.25 PLP协议

该协议主要是实现虚电路。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/a619142f51626d861d7deb555c944e01.png#pic_center)
图中有A、B、C、D、E和F共6个分组交换机。

假定每个交换机可以支持4条虚电路，故需要4对缓冲区。以图中“1-BCD-2”为例，它从B节点开始，经过C节点，到达D节点连接的主机。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/80f6c036d2318d01c62c028b841786ce.png#pic_center)
上图是通过两次握手建立和释放虚电路连接的例子。

联网的两个DTE通过交换Call Request、Incoming Call、Call Accepted和Call Connected建立连接，并协商连接的参数。连接虚电路则交换Clear Request、Clear Indication、Clear Response和Clear Confirm这4个分组。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/2a156bc5356da50ad63d3b8ad5345713.png#pic_center)


X.25的数据块为128字节，再加24位或32位的分组头。默认窗口大小是2，差错控制采用后退N帧ARQ协议。