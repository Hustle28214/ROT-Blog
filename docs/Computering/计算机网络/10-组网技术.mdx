import WordCount from '../../../src/components/WordCount/WordCount';

<WordCount>

## 交换机基础
　　
### 交换机分类
　　> 根据交换方式分
　　
　　- 存储转发式交换（Store and Forward）完整接收数据帧，缓存、验证、碎片过滤，然后转发。
　　优点：可以提供差错校验和非对称交换。
　　缺点：延迟大。
　　
　　- 直通式交换（Cut-through）输入端口扫描到目标地址后立即开始转发。
　　优点：延迟小，交换速度快。
　　缺点：没有检错能力，不能实现非对称交换。
　　
　　> 非对称交换：非对称LAN交换机提供不同带宽端口间的交换连接，而对称交换提供同带宽端口间的交换连接。
　　
　　- 碎片过滤式交换（Fragment Free）开始转发前先检查数据包的长度是否够64个字节，若小于64个字节，说明书冲突碎片，丢弃；若大于等于64个字节，则转发该包。
　　
### 其他分类方式
　　
1. 根据交换的协议层划分：二层交换机、三层交换机、多层交换机。
　　
2. 根据交换机结构划分：固定端口交换机、模块化交换机。

4. 根据配置方式划分：堆叠交换机、非堆叠交换机。
5. 根据管理类型划分：网管交换机、非网管交换机、智能交换机。
6. 层次结构划分：**核心交换机、汇聚交换机、接入交换机**。
　　
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/b9db882b385a6523393b47e1a418fe23.png)
接入层交换机：接入层是工作站连接网络的入口，用以实现用户的网络访问控制。机型有Huawei S2700。

汇聚层交换机：汇聚层将网络划分为多个广播/组播域，可以实现VLAN间的路由选择，并通过访问控制列表实现分组过滤。这一层交换机的端口数量和交换速率要求不是很高，但应提供第三层交换功能。（汇聚层提供两层功能）机型有Huawei S5700-SI。

核心层交换机：核心层应采用可扩展的高性能交换机组成园区网的主干线路，提供链路冗余、路由冗余、VLAN中继和负载均衡等功能，并且与回去吃交换机具有兼容的技术，支持相同的协议。机型有Huawei S6700。
## 级联和堆叠
级联：把二个以上的设备通过某种方式连接起来，能起到扩容的效果就是级联。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/eac54bc14f669dfeb2f6f99d75db6aa5.png)

当接入的用户数增加到原来的交换机端口密度不能满足接入需求时，可以增加新交换机与原交换机组成堆叠系统扩展端口数量。
　　
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/81f8d210db58e40733fa45d529600642.png)

需要增大交换机上行带宽时，可以增加新交换机与原交换机组成堆叠系统，将成员交换机的多条物理链路配置成一个聚合组，提高交换机的上行带宽，同时形成设备间备份和链路的跨设备冗余备份，增加可靠性。
　　
堆叠相当于把N台交换机的端口聚合在一起用，非常方便，所以有时也被称为虚拟化。

这样做的好处是：

1. 逻辑上把多台设备虚拟成一台设备，简化运维，方便管理。
　　
2. 一台物理设备故障，其他设备可以接管转发、控制平台，避免了单点故障
　　
3. 跨设备的链路聚合，物理上的无环网络，无需再部署STP。
　　
4. 链路聚合中的链路全部有效使用，链路利用率100%。
　　
但同时这样做也有一定的劣势：
　　
1. 首先，堆叠是私有协议，不支持跨厂商设备堆叠。华为不能堆叠思科，思科不能堆叠华为。
2. 需要单独购买堆叠线缆。（现在最新用光纤也能实现堆叠）
3. 存在一定的资源浪费，对于高端设备，如果2台核心都配置双引擎，堆叠后只有1个引擎工作。
4. 如果堆叠系统升级或者重启，一般会有20-60s的业务中断。
5. 可靠性风险：控制层面统一后，相当于把鸡蛋放在一个篮子里，如果整个逻辑设备的控制平面出现问题（比如路由表被攻击破坏），就有可能导致整机瘫痪，影响范围大。

需要注意，软考中的大题曾经考过3点优势劣势，需要注意堆叠的考点。
### 交换机性能参数
　　
端口类型：RJ45电口、光口（SC/GBIC/SFP(千兆接口)/SPF+(万兆接口)/SFP28(100G)/QSFP(40G)）

> GBIC（Gigabit Interface Converter）是千兆位接口转换器的简称，用于将位电信号转换为光信号的热插拔器件，分为用于级联的GBIC模块和用于堆叠的GBIC模块。
> SFP（Small Form-factor Pluggables，小型机架可插拔设备）是GBIC的升级版本，其功能基本与GBIC一致，但“瘦身”了一半。有时被称作小型化GBIC（MINI-GBIC）模块。



传输模式：半双工、全双工。

> 除此之外，还有全双工/半双工自适应模式。光纤标准中，仅100BASE-TX支持自适应，其他标准均不支持。不同传输模式和速率的光纤端口不能通信。

交换容量：**端口数\*端口速率\*2**。（全双工）

包转发率：单位时间内发送64字节数据包的个数 1000Mbps/8/(64+8+12)=1.488Mbps。

MAC地址数：交换机MAC地址表中可以存储最大的MAC地址数量。

VLAN表项：交换机最大支持VLAN数量4094个。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/c3365b6b8ba2c0cd51bb1805fa34d128.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/9aa413325476619e6d6bcf0978665eef.png)
交换机的一些常见技术参数：

>交换机的一些常见技术参数：
>**MDI**：介质相关接口（英语：Medium Dependent Interface，缩写MDI）也称介质有关接口。它是用来描述计算机网络中一个从物理层实现到物理介质的传输数据段物理或电气/光学接口。与MDI接口互联时需使用交叉电缆，与MDIX接口互联时使用直通电缆。
>**MDIX**：双绞线以太网定义的“交叉模式介质相关接口”，自动MDIX端口能检测连接是否需要交叉，自动选择MDI或MDIX配置以正确匹配另一端的链路。与MDIX接口互联时需使用交叉电缆，与MDI接口互联时使用直通电缆。将一侧的发射器连接到另一侧的接收器（反之亦然）的要求是两个设备间必须始终有奇数个交叉（crossovers）。每个MDIX接口里内置一个交叉，所以连接“自家人”就需要再在电缆中进行一次交叉以做到奇数，而MDI和MDIX之间使用直通电缆连接就能保证有一个交叉。
>**自动翻转**：Auto MDI/MDIX，网线的交叉线和直连线自动转换。
>**正线/反线**：正线一般用于交换机接路由器，交换机连接PC；反线一般用于交换机接交换机，路由器接路由器，PC机接PC机以及路由器接PC。但现在线序自适应的推广让正线/反线能被自动识别/调节，也就不再那么重要。
>**网管型交换机**：通过管理端口执行监控交换机端口、划分VLAN、设置trunk端口等功能。它具备VLAN、CLI、SNMP、IP路由、QoS等特点功能，常用于核心层。
>**非网管交换机**：即插即用，又被称为傻瓜型交换机，不对数据做直接处理，不需要任何设置，你只需要插上一根网线。但太过简洁的问题就是它**不支持**VLAN、DHCP、MAC地址绑定、ARP防护、SNMP功能、流量控制、端口镜像等。但便宜好用是硬道理。机型有TP-LINK TL-SG1005D。一般是家用。
>**线速转发**：线速转发是指在满负载情况下，对帧进行无差错的转发，是一种高速转发。线速即是交换机理想状态下的最大数据率（bps/mpps）。
>**背板带宽**：也称为交换容量，是交换机接口处理器或接口卡和数据总线间所能吞吐的最大数据量。
## 路由器基础

### 路由器分类

1. 骨干路由器（线速路由器）：实现主干网络互连的关键设备，通常采用模块化结构，通过过热备份、双电源和双数据通路等冗余技术提高可靠性，并采用了缓存技术和专用集成电路（ASIC）加快路由表的查找，使得背板交换能力达到上百Gbps，由此又称为线速路由器。机型有Huawei NE40E。
2. 企业级路由器：连接着许多终端系统，提供通信分类、优先级控制、用户认证、多协议路由和快速自愈等功能。要求是实现高密度的LAN端口，同时支持多种业务。机型有Huawei AR111-S等。
3. 接入级路由器（边缘路由器）：主要用于小型企业的客户群，提供1-2个广域网端口卡（WIC），实现简单的信息传输功能。机型有Huawei AR3600以下型号。

>华为的NE40E比较有意思，它采用了SRv6的技术。SRv6（Segment Routing IPv6，基于IPv6转发平面的段路由）简单来讲即SR（Segment Routing）+IPv6，是新一代IP承载协议。其采用现有的IPv6转发技术，通过灵活的IPv6扩展头，实现网络可编程。它号称是未来网络的灵魂，值得一提的是它可能还真的具有这个实力。SR具有源路由特点，让网络变得简单可控，IPv6具有可扩展的特点，并且SRv6支持编程，让SRv6的普适性大大增强，适应5G、6G未来的用网需求。以IPv6、SRv6为代表的新网络，统称为“IP 3.0”

路由器接口较交换机复杂些。
　　
接口类型：广域网WAN端口和局域网LAN端口。

RJ45端口：常规以太网电口。

以太网光口：SC/GBIC/SPF/SPF+/SPF28

AUI端口：用于令牌环或总线型以太网接口。

Serial串口：用于连接DDN、帧中继、X.25、PSTN等网络。

ISDN BRI/PRI端口：ISDN线路互联。

SDH POS接口：155M/622M/2.5G/10G。

PON接口：城域网的接入手段
### 路由器端口
#### RJ-45端口
RJ-45端口通过双绞线连接以太网。10BASE-T的RJ-45端口表示为ETH，而100BASE-TX的RJ-45端口标识为10/100 b TX，这样标识是因为路由器电路设计采用10/100Mbps自适应电路。
　

#### AUI端口

AUI端口是一种D型15针连接器，用在令牌环网或总线型以太网。路由器经过AUI端口通过粗同轴电缆收发器连接10Base-5网络，或外接的AUI-to-RJ-45适配器连接10Base-T以太网，或其他适配器连接10Base-2细同轴电缆或10Base-F光缆。

#### 高速同步串口

高速同步串行口（Synchronous Serial Port）多用于连接DDN、帧中继、X.25和PSTN等网络。如此可以以很高的速率同步通信进行数据传输。

#### ISDN BRI端口

这种端口通过ISDN线路实现路由器与Internet或其他网络的远程连接，端口采用RJ-45标准。

#### Console端口

通过配置专用电缆连接至计算机串行口，利用终端仿真程序（如Hyper Terminal）对路由器进行本地配置。端口为RJ-45标准。不支持硬件流控。

#### AUX端口
对路由器进行远程配置时使用该端口（Auxiliary Prot）。AUX端口与RJ-45端口外观一样，但内部电路不同，功能也不同。通过AUX端口与光猫Modem连接必须接适配器，即RJ-45 to DB9或RJ-45 to DB25适配器操作电路转换。支持硬件流控。
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/e09e28da14773cf5968a1387d3a7eb86.png#pic_center)


### 交换机路由器管理方式
　　
　　- Console接口（最基础最常用）
　　- AUX端口连接Modem
　　- Telnet/SSH
　　- 浏览器
　　- 网管软件

一般来说，路由器串口连接是点对点通信，而以太网口一般是点对多点的通信。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/7d1835f2c1a19be4b4c0908ee63b7044.png)
### 路由器的操作系统

华为路由器的操作系统采用的是通用路由平台VRP（Versatile Routing Platform），常用的VRP有VRP5和VRP8两个版本。VRP5是目前大多数华为设备使用的组件化设计、高可靠性网络操作系统，VRP8支持分布式应用和虚拟化技术，可以适应企业快速扩展的业务需求。

IOS软件系统包括“BootROM软件”和“系统软件”两部分，是路由器、交换机等设备启动、运行的必要软件。BootROM软件在设备加电后首先运行，初始化硬件并显示硬件参数信息，然后再运行系统软件。

路由器或交换机的操作是由配置文件（configuration file或config）控制的。配置文件由网络管理员创建，一般在几百到几千字节大小。

IOS有3种命令级别，分别为用户视图、系统视图和具体业务视图。

## 配置和管理VLAN
VLAN技术是交换技术的重要组成部分，是交换机配置的基础。本质上是逻辑划分子网。每个VLAN对应着一个广播域，处于不同VLAN上的主机不能进行通信，需要引入第三层交换技术才能解决。

链路类型：主要有**接入链路**（Access Link）和**干道链路**（Trunk Link）两种类型。
接入链路只能承载一个VLAN的数据帧，用于连接交换机和用户终端；干道链路能承载多个VLAN的数据帧，用于交换机间互连或连接交换机和路由器。根据接口连接对象和收发数据帧处理的不同，以太网接口分为Access接口、Trunk接口、Hybrid接口和QinQ接口4种接口类型（第4章已经提过），分别用于连接终端用户、交换机与路由器以及公网与私网的互联等。
### 划分VLAN方法

VLAN的实现方法有很多种。

1.通过**接口**划分

交换机的每个接口配置不同的PVID，当数据帧进入交换机时没有带VLAN标签，它就会被打上接口指定PVID的Tag并在指定PVID中传输。

2.通过**源MAC地址**划分

建立MAC地址和VLAN ID映射关系表，当交换机收到Untagged帧时，就依据该表给数据帧添加指定VLAN的Tag并在指定VLAN中传输。


3.通过**子网**划分

建立IP地址和VLAN ID映射关系表，当交换机收到Untagged帧，就依据该表给数据帧添加指定VLAN的Tag并在指定VALN中传输。

4.通过**策略匹配**划分

实现多种组合划分，当收到Untagged帧且匹配配置的策略时，给数据帧添加指定VLAN的Tag并在指定VLAN中传输。

### 配置GVRP协议

GVRP（Generic VLAN Registration Protocol）是通用属性注册协议（GARP）的应用，提供802.1Q兼容的VLAN裁剪VLAN pruning功能和在802.1Q干线端口trunk port上建立动态VLAN的功能。

GVRP用于注册和注销VLAN属性，GARP通过目的MAC地址区分不同的应用。

（网络工程师教程第五版在此处有误，混淆了GARP和GVRP）

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/4a52499766e7ab0956c984b3d7baff66.png)
### 配置生成树（STP）协议

生成树协议是为了实现交换机之间冗余连接的同时避免网络环路的出现，通过阻断相应端口来消除网络环路，在交换机之间传递BPDU（Bridge Protocol Data Unit，桥接协议数据单元），互相告知诸如交换机的桥ID、链路开销（Path Cost）和根桥ID等信息，从而确定根桥，决定将哪些端口置于转发状态，将哪些端口置于阻断状态，用于消除环路。

网络规划中出于冗余备份的需要，在设备之间部署多条链路时需要部署生成树协议（STP），避免广播风暴和MAC表项被破坏。它的工作原理是当前网络中设备都运行STP，通过相互的信息交换发现网络中存在的环路，有选择的对某个端口进行堵塞，将环形网络结构修剪成无环路的树形网络结构，从而避免其造成的故障。


![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/aa595bbc1c084eddd2798d9dacd9b3d2.png#pic_center)
### 配置路由器

#### 1.路由器的命令状态

前文已经提及路由器的配置操作有3种模式，即用户视图、系统视图和具体业务视图。

用户视图：用户可以完成查看运行状态和统计信息等功能；

系统视图：用户可以配置系统参数和通过该视图进入其他的功能配置视图；

具体业务视图：用户可以配置接口相关的物理属性、链路层特性以及IP地址等重要参数。

配置模式分为非常多种，常用的有全局配置模式、接口配置模式、路由协议配置模式、线路配置模式等子模式。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/ec57f88318e36825237731f8f5bdd3d8.png)
#### 2.路由器的基本配置

配置enable命令、enable密码和主机名，在路由器中同样可以配置启用口令（enable password）和启用密码（enable secret），一般只需要配置一个。

两者同时配置，也不会过定义，后者生效。

路由器上一般会有以太网接口槽，每个槽提供一个或者多个以太网（Ethernet）接口（一个的情况在旧机型比较常见），命名为例如Ethernet0/0、GigabitEthernet0/0/1，或者缩写为Eth0/0、GE0/0/1。PC和路由器通过Console电缆线直连就可以开始配置。


#### 3.批量配置技术

华为交换机AR系列路由器通过Auto-Config功能实现设备的批量配置。Auto-Config是指新出厂或空配置设备加电启动时采用的一种自动加载版本文件。

RouterA/B/C运行Auto-Config功能后，设备作为DHCP客户端向DHCP定时发送DHCP请求报文，获得配置信息；然后DHCP服务器向待配置设备响应DHCP应答报文，报文内容有：分配给待配置设备的IP地址、文件服务器的IP地址、文件服务器的登录方式、版本文件的配置信息，最后设备可以通过DHCP响应报文的配置信息，获取版本文件并设置下次启动加载，这样就能实现版本文件自动加载了。


![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/81966e5c274b27228b97033f4993441f.png)
#### 4.配置静态路由

配置静态路由可以人为指定对某一网络访问时所要经过的路径，一般在到达某一网络经过路径比较唯一的情况下采用。

1. IPv4静态路由设置
2. IPv6静态路由设置
3. 检查配置结果




</WordCount>